<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Категория: Web | Ctrl + Cmd]]></title>
  <link href="http://goooseman.ru/categories/web/atom.xml" rel="self"/>
  <link href="http://goooseman.ru/"/>
  <updated>2014-03-05T10:40:28+04:00</updated>
  <id>http://goooseman.ru/</id>
  <author>
    <name><![CDATA[goooseman]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Баг в AngularJS Bootsrap-UI]]></title>
    <link href="http://goooseman.ru/2014/03/04/bagh-v-angularjs-bootstrap-ui/"/>
    <updated>2014-03-04T23:47:00+04:00</updated>
    <id>http://goooseman.ru/2014/03/04/bagh-v-angularjs-bootstrap-ui</id>
    <content type="html"><![CDATA[<p><img class="center <a" src="href="http://95.85.35.239/ftp/Screen_Shot_20140304_at_23.53.19.png">http://95.85.35.239/ftp/Screen_Shot_20140304_at_23.53.19.png</a>" title="&lsquo;Controller carousel, required by directive ngTransclude, can&rsquo;t be found!&rsquo; &lsquo;Controller carousel, required by directive ngTransclude, can&rsquo;t be found!&rsquo;" ></p>

<p>Недавно подключил к проекту <a href="http://angular-ui.github.io/bootstrap/">AngularJS Bootstrap-UI</a> и сразу обнажурил баг: на страницах, где используется carousel (класс для слайдшоу в Bootstrap), выскакивает следующая ошибка:<br/>
<code>
Controller 'carousel', required by directive 'ngTransclude', can't be found!
</code></p>

<!-- more -->


<p>Полный лог:</p>

<p><code>
Error: [$compile:ctreq] Controller 'carousel', required by directive 'ngTransclude', can't be found!
http://errors.angularjs.org/1.2.13/$compile/ctreq?p0=carousel&amp;p1=ngTransclude
at http://aliya-soap.ru/assets/application-177047d459241e8020f5604db9c970de.js.pagespeed.jm.eNxPlzr5Jo.js:1:146612
at g (http://aliya-soap.ru/assets/application-177047d459241e8020f5604db9c970de.js.pagespeed.jm.eNxPlzr5Jo.js:1:169688)
at v (http://aliya-soap.ru/assets/application-177047d459241e8020f5604db9c970de.js.pagespeed.jm.eNxPlzr5Jo.js:1:171431)
at http://aliya-soap.ru/assets/application-177047d459241e8020f5604db9c970de.js.pagespeed.jm.eNxPlzr5Jo.js:1:174956
at http://aliya-soap.ru/assets/application-177047d459241e8020f5604db9c970de.js.pagespeed.jm.eNxPlzr5Jo.js:1:180992
at u (http://aliya-soap.ru/assets/application-177047d459241e8020f5604db9c970de.js.pagespeed.jm.eNxPlzr5Jo.js:1:195225)
at u (http://aliya-soap.ru/assets/application-177047d459241e8020f5604db9c970de.js.pagespeed.jm.eNxPlzr5Jo.js:1:195225)
at http://aliya-soap.ru/assets/application-177047d459241e8020f5604db9c970de.js.pagespeed.jm.eNxPlzr5Jo.js:1:195902
at u.$eval (http://aliya-soap.ru/assets/application-177047d459241e8020f5604db9c970de.js.pagespeed.jm.eNxPlzr5Jo.js:1:200165)
at u.$digest (http://aliya-soap.ru/assets/application-177047d459241e8020f5604db9c970de.js.pagespeed.jm.eNxPlzr5Jo.js:1:198869) &lt;div ng-class="{
'active': leaving || (active &amp;amp;&amp;amp; !entering),
'prev': (next || active) &amp;amp;&amp;amp; direction=='prev',
'next': (next || active) &amp;amp;&amp;amp; direction=='next',
'right': direction=='prev',
'left': direction=='next'
}" class="left carousel-control item text-center ng-isolate-scope" ng-transclude="" href="#carousel-example-generic" data-slide="prev"&gt;
</code></p>

<p>Погуглив, обнаружил, что я <a href="http://stackoverflow.com/questions/20137900/controller-carousel-required-by-directive-ngtransclude-cant-be-found">не единственный, кто встретил этот баг</a>, вот только единственное решение, которое там предложили &ndash; отключить <code>ui.bootstrap</code>.</p>

<p>Баг находится в директиве <code>carousel</code> контроллера <code>ui.bootstrap.carousel</code>. Можно конечно его удалить из исходников, но я предлагаю способ лучше: переинициализировать этот модуль в нашем javascript файле:</p>

<p>``` javascript application.js
angular.module(&lsquo;ui.bootstrap.carousel&rsquo;, [&lsquo;ui.bootstrap.transition&rsquo;])</p>

<pre><code>.controller('CarouselController', ['$scope', '$timeout', '$transition', '$q', function ($scope, $timeout, $transition, $q) {
}]).directive('carousel', [function() {
    return {

    }
</code></pre>

<p>}]);
```</p>

<p>Причина бага? Я её, честно говоря, не вижу. Директива должна вызываться только от аттрибута или элемента &lsquo;carousel&rsquo;, но по непонятной причине вызывается и от класса с таким именем.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Трудности favicon]]></title>
    <link href="http://goooseman.ru/2014/02/28/trudnosti-favicon/"/>
    <updated>2014-02-28T11:55:00+04:00</updated>
    <id>http://goooseman.ru/2014/02/28/trudnosti-favicon</id>
    <content type="html"><![CDATA[<p><img class="center <a" src="href="http://95.85.35.239/ftp/20140228170321.png">http://95.85.35.239/ftp/20140228170321.png</a>" title="&lsquo;Трудности favicon&rsquo; &lsquo;Трудности favicon&rsquo;" >
Готовясь к <a href="http://academy.1c-bitrix.ru/konkurs/">студенческой олимпиаде по web-разработке</a>, я понял, что надо уделить внимание мелочам. Вот, например, favicon. Что может быть проще? Положил favicon.ico в корень и радуешься жизни. <a href="https://github.com/audreyr/favicon-cheat-sheet">А вот и не все так просто.</a></p>

<ul>
<li>Во-первых, в идеале favicon.ico должен содержать иконки следующих размеров: 16х16, 24x24, 32x32, 48x48, 64x64.</li>
<li>Во-вторых, еще бы не помешали иконки в .png следующих размеров (для живых тайлов в IE11): 70x70, 150x150, 310x310.</li>
<li>В-третих, еще бы нужна иконка в .png размеров 195x195 для Opera Speed Dial.</li>
<li>Наконец, <a href="http://mathiasbynens.be/notes/touch-icons#sizes">иконки для iOS и Android</a> нужны следующих размеров (для поддрежки как и iOS ≤ 6, так и iOS ≥ 7): 57х57, 72x72, 76x76, 114x114, 120x120, 144x144, 152x152.</li>
</ul>


<p>Конечно, это все необязательно, но уж точно хуже не будет. Но как генирировать такое кол-во иконок?</p>

<!--more-->


<h1>PSD шаблон?</h1>

<p>Сначала я нашёл <a href="https://github.com/jonrandahl/H5BP-Multi-Layer-FavIcons">.psd шаблон</a>, который автоматически генерит иконки нужных размеров. Но он не рассчитан под новые размеры, которые рекоммендует Apple после выхода iOS 7 (76x76, 120x120, 152x152). Не беда! <a href="https://github.com/goooseman/H5BP-Multi-Layer-FavIcons-iOS7">Форкнул, отредактировал, закоммитил, запушил</a>. Теперь с <del>блекджеком</del> поддержкой iOS 7. Но все же как то это не удобно: фотошоп, да и .ico файл сам не генерит. Слижком много движений руками.</p>

<h1>Скрипт?</h1>

<p>Нашёл скрипт <a href="https://github.com/emarref/webicon">webicon.sh</a>, который генерит .png разного размера, затех из них делает .ico и показывает html код, который надо вставить в шапку страницы. Но меня он тоже не устроил. <a href="https://github.com/goooseman/webicon">Форкнул</a>, изменил. В отличиее от первоначального варианта, моя версия скрипта:</p>

<ul>
<li>Оптимизирует каждый сгенерированный .png коммандой <code>optipng</code> (<strong>новая зависимость</strong>)</li>
<li>Иконки для iOS (и Android) получают название в соответствии с шаблоном: apple-touch-icon-РАЗМЕРхРАЗМЕР-precomposed.png</li>
<li>Иконки для iOS (и Android) делаются непрозрачными (прозрачный заменяется на белый)</li>
<li>favicon.ico может быть прозрачной</li>
<li>favicon.ico включает в себя следующие размеры: 16х16, 24x24, 32x32, 48x48, 64x64</li>
<li>Те .png, которые необходимы только для генерации .ico, удаляются</li>
<li>Добавлена генерация .png размеро 195х195 для поддержки Opera Speed Dial</li>
<li>Отредактирован вывод html (улучшена поддрежка iOS, добавлена поддержка Opera Speed Dial)</li>
<li>Добавлено изображение для теста</li>
</ul>


<p>Теперь скрипт генерит следующие файлы:</p>

<ul>
<li>apple-touch-icon-57x57-precomposed.png</li>
<li>apple-touch-icon-72x72-precomposed.png</li>
<li>apple-touch-icon-76x76-precomposed.png</li>
<li>apple-touch-icon-114x114-precomposed.png</li>
<li>apple-touch-icon-120x120-precomposed.png</li>
<li>apple-touch-icon-144x144-precomposed.png</li>
<li>apple-touch-icon-152x152-precomposed.png</li>
<li>favicon-70.png</li>
<li>favicon-150.png</li>
<li>favicon-195.png</li>
<li>favicon-310.png</li>
<li>favicon.ico</li>
</ul>


<p>После генерации скрипт показывает следующий код, который нужно вставить в <code>&lt;head&gt;</code> сайта:</p>

<p>``` html
<link rel="icon" sizes="16x16 32x32 48x48 64x64" href="favicon.ico"></p>

<!--[if IE]><link rel="shortcut icon" href="favicon.ico"><![endif]-->




<!-- The below are optional but encouraged -->




<!-- The below are optional -->




<!-- IE 10 Metro tile icon (Metro equivalent of apple-touch-icon): -->


<p><meta name="msapplication-TileColor" content="#FFFFFF">
<meta name="msapplication-TileImage" content="apple-touch-icon-144x144-precomposed.png"></p>

<!-- Opera Speed Dial icon -->


<p><link rel="icon" sizes="195x195" href="favicon-195.png"></p>

<!-- IE 11 live tiles: -->


<p><meta name="msapplication-square70x70logo" content="favicon-70.png" />
<meta name="msapplication-square150x150logo" content="favicon-150.png" />
<meta name="msapplication-square310x310logo" content="favicon-310.png" /></p>

<!-- For iPad with high-resolution Retina display running iOS ≥ 7: -->


<p><link rel="apple-touch-icon-precomposed" sizes="152x152" href="apple-touch-icon-152x152-precomposed.png"></p>

<!-- For iPad with high-resolution Retina display running iOS ≤ 6: -->


<p><link rel="apple-touch-icon-precomposed" sizes="144x144" href="apple-touch-icon-144x144-precomposed"></p>

<!-- For iPhone with high-resolution Retina display running iOS ≥ 7: -->


<p><link rel="apple-touch-icon-precomposed" sizes="120x120" href="apple-touch-icon-120x120-precomposed.png"></p>

<!-- For iPhone with high-resolution Retina display running iOS ≤ 6: -->


<p><link rel="apple-touch-icon-precomposed" sizes="114x114" href="apple-touch-icon-114x114-precomposed.png"></p>

<!-- For the iPad mini and the first- and second-generation iPad on iOS ≥ 7: -->


<p><link rel="apple-touch-icon-precomposed" sizes="76x76" href="apple-touch-icon-76x76-precomposed.png"></p>

<!-- For the iPad mini and the first- and second-generation iPad on iOS ≤ 6: -->


<p><link rel="apple-touch-icon-precomposed" sizes="72x72" href="apple-touch-icon-72x72-precomposed.png"></p>

<!-- For non-Retina iPhone, iPod Touch, and Android 2.1+ devices: -->


<p><link rel="apple-touch-icon-precomposed" href="apple-touch-icon-57x57-precomposed.png">
```</p>

<p><a href="https://github.com/goooseman/webicon">Скачать скрипт</a>. Перед использованием необходимо установить <a href="http://www.imagemagick.org/">imagemagick</a> и <a href="http://optipng.sourceforge.net/">optipng</a>. На маке легче всего это сделать через <a href="http://brew.sh/">homebrew</a>. Сам скрипт лучше всего его положить в папку, которая включена в $PATH, чтобы с легкостью запускать его просто коммандой <code>webicon.sh</code>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ошибка Capistrano bundle: not found]]></title>
    <link href="http://goooseman.ru/2014/01/08/oshchibka-capistrano-bundle-not-found/"/>
    <updated>2014-01-08T23:48:00+04:00</updated>
    <id>http://goooseman.ru/2014/01/08/oshchibka-capistrano-bundle-not-found</id>
    <content type="html"><![CDATA[<p><img class="center <a" src="href="http://d.pr/i/Ftgm+">http://d.pr/i/Ftgm+</a>"><br/>
Для деплоя своих проектов на Rails я использую третью версию Capistrano. На серверах я использую rvm для установки ruby и на локалке использую следующий набор гемов:<br/>
<code>ruby Gemfile
  gem 'capistrano'
  gem 'capistrano-rails'
  gem 'capistrano-bundler'
  gem 'capistrano-rvm'
</code><br/>
И тут два дня назад деплой ломается одновременно на обоих моих проектах. На попытке сделать <code>assets:precompile</code> вылетает такая ошибка:<br/>
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>DEBUG [6c391f27] Command: cd /var/www/apps/aliya/releases/20140108194955 &amp;&amp; ( RAILS_ENV=production bundle exec rake assets:precompile )
</span><span class='line'>DEBUG [6c391f27]    bash: bundle: command not found
</span><span class='line'>cap aborted!
</span><span class='line'>rake stdout: Nothing written
</span><span class='line'>rake stderr: Nothing written&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Tasks: TOP => deploy:assets:precompile
</span><span class='line'>(See full trace by running task with &mdash;trace)</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<!-- more -->


<p>Я связал это с выходом новой версии ruby (2.1) и решил прописать в <code>deploy.rb</code> нужную версию:<br/>
<code>ruby deploy.rb
set :rvm_type, :user
set :rvm_ruby_version, '2.0.0-p353'
</code><br/>
Но это не помогло. Тогда я прописал в тот же файл значение переменной $PATH. Для этого заходим по SSH на сервер, выполняем <code>echo $PATH</code> и прописываем его на локалке:<br/>
``` ruby deploy.rb
set :default_env, {</p>

<pre><code>:PATH =&gt; '/home/deployer/.rvm/gems/ruby-2.0.0-p353/bin:/home/deployer/.rvm/gems/ruby-2.0.0-p353@global/bin:/home/deployer/.rvm/rubies/ruby-2.0.0-p353/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/home/deployer/.rvm/bin'
</code></pre>

<p>}
```<br/>
Бинго! Всё работает как раньше.</p>

<p>P.S. Самое интересное, что если прописать $PATH, но не указывать версию ruby, то все равно получаем ошибку, но уже раньше, на <code>bundle install</code><br/>
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cap aborted!
</span><span class='line'>bundle stdout: Nothing written
</span><span class='line'>bundle stderr: Nothing written&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Tasks: TOP => deploy:updated => bundler:install
</span><span class='line'>(See full trace by running task with &mdash;trace)
</span><span class='line'>DEBUG [c90cd2c7]    /home/deployer/.rvm/scripts/set: line 19: exec: bundle: not found</span></code></pre></td></tr></table></div></figure></notextile></div></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Новый Safari и Yandex.Maps 2.1β]]></title>
    <link href="http://goooseman.ru/2013/11/11/novyi-safari-i-yandex-dot-maps-2-dot-1b/"/>
    <updated>2013-11-11T11:45:00+04:00</updated>
    <id>http://goooseman.ru/2013/11/11/novyi-safari-i-yandex-dot-maps-2-dot-1b</id>
    <content type="html"><![CDATA[<p>Я разрабатываю один проект и долго не мог понять, почему при загрузке сайта в Safari (Mavericks) я получаю сообщение &ldquo;A problem occured with this webpage so it was reloaded&rdquo; (&ldquo;При работе с этой веб-страницей произошел сбой, поэтому она была перезагружена&rdquo;), и вылетает crash log Safari.<br/>
<img class="center <a" src="href="http://d.pr/i/YU0p+">http://d.pr/i/YU0p+</a>"></p>

<!-- more -->


<p>При повторной перезагрузке я получаю сообщение &ldquo;A problem repeatedly occured with &hellip;&rdquo; (&ldquo;Повторилась проблема с &hellip;&rdquo;).<br/>
<img class="center <a" src="href="http://d.pr/i/JPRF+">http://d.pr/i/JPRF+</a>"><br/>
Самое интересное, что если открыть консоль, то ничего не падает.<br/>
<img class="center <a" src="href="http://d.pr/i/rCSv+">http://d.pr/i/rCSv+</a>"><br/>
Как Вы могли уже догадаться из скриншотов, проблема на моём сайте оказалась в использовании бета версии Яндекс.Карт за порядковым номером 2.1. Надеюсь, к релизу пофиксят.</p>

<p>UPD: Уже исправили</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Использование fabric.js как инструмент для кропа изображений]]></title>
    <link href="http://goooseman.ru/2013/11/09/ispol%27zovaniie-fabric-dot-js-kak-instrumient-dlia-kropa-izobrazhienii/"/>
    <updated>2013-11-09T14:27:00+04:00</updated>
    <id>http://goooseman.ru/2013/11/09/ispol'zovaniie-fabric-dot-js-kak-instrumient-dlia-kropa-izobrazhienii</id>
    <content type="html"><![CDATA[<p>Задача: сделать инструмент, с помощью которого юзер может обрезать свое изображение по определнной маске.<br/>
Например, есть вот такая рамка:<br/>
<img class="center <a" src="href="http://d.pr/i/E3LK+">http://d.pr/i/E3LK+</a>"><br/>
Юзер может перетягивать свое изображение под этой маской, менять его размер и по нажатии на кнопку, все, что внутри фигуры сохраняется в .png файл.</p>

<!-- more -->


<p>Я буду использовать библиотеку для работы с html5 canvas fabric.js. Ничего более простого я придумать не смог.<br/>
Маска должна быть в .svg, <a href="http://d.pr/f/HxLv">вот</a>, например, моя.<br/>
Создаем два canvas: один статичный (маска то не изменяемая), второй нет (на нем будет фото). Pointer-events мы используем для того, что статичный canvas будет находится над другим (фото должно быть под маской), но pointer-events должны быть только у нижнего.<br/>
``` html</p>

<div class="photo-canvas">
    <canvas id="photo-canvas"></canvas>
</div>


<div class="photo-canvas" style="pointer-events: none;">
    <canvas id="static-photo-canvas"></canvas>
</div>


<p><code>  
</code> css
.photo-canvas {
  width: 500px;
  height: 500px;
  position: absolute;
}
<code>  
Подключаем fabric.js и пишем js:  
</code> javascript
// Создаем холсты
photoCanvas = new fabric.Canvas(&lsquo;photo-canvas&rsquo;);
staticPhotoCanvas = new fabric.StaticCanvas(&lsquo;static-photo-canvas&rsquo;);</p>

<p>// Задаем их размеры
photoCanvas.setHeight($(&lsquo;.photo-canvas&rsquo;).height());
photoCanvas.setWidth($(&lsquo;.photo-canvas&rsquo;).width());
staticPhotoCanvas.setHeight($(&lsquo;.photo-canvas&rsquo;).height());
staticPhotoCanvas.setWidth($(&lsquo;.photo-canvas&rsquo;).width());</p>

<p>// Загружаем маску на статичный холст и устанавливаем ее по центру холста
fabric.loadSVGFromURL(&lsquo;/assets/first.svg&rsquo;, function(objects, options) {</p>

<pre><code>var mask = fabric.util.groupSVGElements(objects, options);
staticPhotoCanvas.add(mask);
mask.center().setCoords();
staticPhotoCanvas.renderAll();
</code></pre>

<p>});</p>

<p>// Загружаем изображение на динамический холст, задаем высота и устанавливаем ее по центру
fabric.Image.fromURL(&lsquo;/assets/Cat.jpg&rsquo;, function(img) {</p>

<pre><code>img.scaleToHeight(500);
photoCanvas.add(img);
img.center().setCoords();
photoCanvas.renderAll();
</code></pre>

<p>});
<code>  
Мы добавили нашу маску на статичный canvas, и изображение - на динамический. Теперь код кнопки "Обрезать":  
</code> javascript
$(&lsquo;#crop-button&rsquo;).click(function(event) {</p>

<pre><code>// Обрезаем холст
photoCanvas.clipTo = function (ctx) {
     staticPhotoCanvas.item(0).render(ctx);
};
photoCanvas.renderAll();

// Сохраняем .png файл в переменную
var dataUrl = photoCanvas.toDataURL('png'); 
</code></pre>

<p>});
```<br/>
То есть мы обрезали наш canvas с фотографией по контору векторной маски и сохранили его в png файл, который хранится в переменной dataUrl.<br/>
Результат работ:<br/>
<img class="center <a" src="href="http://d.pr/i/LiuH+">http://d.pr/i/LiuH+</a>"><br/>
P.S. Если нужно создать canvas в модальном окне Bootstrap 3, то лучше создавать холст на событии &lsquo;shown.bs.modal&rsquo;. Иначе он не будет принимать pointer events.</p>
]]></content>
  </entry>
  
</feed>
